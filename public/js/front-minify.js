"use strict";let url=window.location.origin+"/",maps=L.map("mapid",{fullscreenControl:!0,center:new L.LatLng(-7.694512268978755,110.67233986914458),zoom:12});L.tileLayer("http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}",{maxZoom:60,subdomains:["mt0","mt1","mt2","mt3"]}).addTo(maps);let polygon=[];const refreshButton=L.easyButton({id:"refresh-view-button",states:[{icon:"fas fa-sync-alt",title:"Refresh",stateName:"refresh-view",onClick:async()=>{$("#loading").show(),await maps.eachLayer((function(t){t.toGeoJSON&&maps.removeLayer(t)})),await L.geoJSON(getGeoJSONData(),{style:function(t){return{color:t.properties.color}},onEachFeature:onEachFeatureCallback}).addTo(maps).openPopup(),$("#loading").fadeOut()}}]}).addTo(maps),searchControl=(new L.esri.Controls.Geosearch).addTo(maps),results=(new L.LayerGroup).addTo(maps);searchControl.on("results",(function(t){results.clearLayers()})),setTimeout((function(){$(".pointer").fadeOut("slow")}),3400);const getGeoJSONData=()=>{let t;return $.ajax({headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:window.location.protocol+"//"+window.location.host,type:"GET",async:!1,cache:!1,success:function(e){t=e.data}}),t},getPopupContent=t=>`\n    <table class="pop-table">\n      <tr>\n        <th>Jumlah Korban</th>\n        <td>: ${t.total_victims} orang</td>\n      </tr>\n      <tr>\n        <th>Tanggal Awal Kejadian</th>\n        <td>: ${t.date_in_time} WIB, ${t.date_in}</td>\n      </tr>\n      <tr>\n        <th>Tanggal Akhir Kejadian</th>\n        <td>: ${!1===t.date_out?"Sedang Berlangsung":t.date_out_time+" WIB, "+t.date_out}</td>\n      </tr>\n      <tr>\n        <th>Jumlah Kelurahan yang terdampak</th>\n        <td>: ${t.total_village} Kelurahan</td>\n      </tr>\n      <tr>\n        <th>Level</th>\n        <td>: ${t.level.name} &nbsp;&nbsp;<i class="fa fa-info-circle tooltipped" data-toggle="tooltip" data-placement="top" title="${t.level.desc}"></i></td>\n      </tr>\n      <tr>\n        <th>Untuk lebih jelas</th>\n        <td>: <a href="${t.url}">Klik Disini</a></td>\n      </tr>\n    </table>\n  `,onEachFeatureCallback=(t,e)=>{if(t.properties&&t.properties.popupContent){let{id:o,total_victims:l,total_village:i,date_in:r,date_in_time:s,date_out:d,date_out_time:p,url:u,address:c,level:h}=t.properties.popupContent,m={id:o,total_victims:l,total_village:i,date_in:r,date_in_time:s,date_out:d,date_out_time:p,url:u,address:c,level:h};var a=e.bindPopup(`\n    <table class="pop-table">\n      <tr>\n        <th>Jumlah Korban</th>\n        <td>: ${(n=m).total_victims} orang</td>\n      </tr>\n      <tr>\n        <th>Tanggal Awal Kejadian</th>\n        <td>: ${n.date_in_time} WIB, ${n.date_in}</td>\n      </tr>\n      <tr>\n        <th>Tanggal Akhir Kejadian</th>\n        <td>: ${!1===n.date_out?"Sedang Berlangsung":n.date_out_time+" WIB, "+n.date_out}</td>\n      </tr>\n      <tr>\n        <th>Jumlah Kelurahan yang terdampak</th>\n        <td>: ${n.total_village} Kelurahan</td>\n      </tr>\n      <tr>\n        <th>Level</th>\n        <td>: ${n.level.name} &nbsp;&nbsp;<i class="fa fa-info-circle tooltipped" data-toggle="tooltip" data-placement="top" title="${n.level.desc}"></i></td>\n      </tr>\n      <tr>\n        <th>Untuk lebih jelas</th>\n        <td>: <a href="${n.url}">Klik Disini</a></td>\n      </tr>\n    </table>\n  `);polygon.push(a)}var n};var geoJsonLayer=L.geoJSON(getGeoJSONData(),{style:function(t){return{color:t.properties.popupContent.level.color}},onEachFeature:onEachFeatureCallback}).addTo(maps);const showPath=t=>{for(var e in polygon){polygon[e].feature.properties.popupContent.id==t&&(maps.fitBounds(polygon[e].getBounds()),polygon[e].openPopup())}};let counting=0;geoJsonLayer.eachLayer((function(t){let e=t.feature.properties.popupContent;counting+=1;const a=e.address.reduce(((t,e,a)=>0==a?e.village.toLowerCase()+"-"+e.district.toLowerCase():t+", "+e.village.toLowerCase()+","+e.district.toLowerCase()),"");$("#tBodyField").append(`\n    <tr>\n      <td>\n        <b>${counting}</b>\n      </td>\n      <td>\n        <p>${a}</p>\n      </td>\n      <td>\n        <span class="text-muted">${e.date_in}, Pukul ${e.date_in_time}</span>\n      </td>\n      <td>\n        <span class="text-muted">${!1===e.date_out?"Sedang Berlangsung":e.date_out_time+" WIB, "+e.date_out}</span>\n      </td>\n      <td>\n        <span class="text-muted tooltipped" data-position="top" data-tooltip="${e.level.desc}">${e.level.name}</span>\n      </td>\n      <td class="table-actions">\n        <button type="button" class="waves-effect waves-light btn tooltipped modal-close" data-position="top" data-tooltip="Tunjuk Arah Pada Peta" onclick="showPath('${e.id}')">\n          <i class="material-icons">navigation</i>\n        </button>\n        <a href="${e.url}" class="waves-effect waves-light btn tooltipped" data-position="top" data-tooltip="Tampilkan Data Banjir Lebih Jelas">\n          <i class="material-icons">open_in_new</i>\n        </a>\n      </td>\n    </tr>\n  `)}));